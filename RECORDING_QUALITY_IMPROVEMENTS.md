# 録音品質向上の実装

## 概要
ボイスメモとボイスタスクの音声認識精度を向上させるため、録音品質の最適化を実装しました。

## 主な改善点

### 1. 録音設定の最適化
- **ビットレート向上**: 128kbps → 192kbps
- **モノラル録音**: 音声認識に最適化
- **高サンプリングレート維持**: 44.1kHz

### 2. 音声レベル自動調整（強化版）
- **3段階調整**: 非常に低い/低い/高すぎる音声レベルに対応
- **RMS計算**: より正確な音声レベル分析
- **適応的増幅**: 音声レベルに応じた最適な増幅率

### 3. ノイズリダクション機能
- **ハイパスフィルター**: 100Hz以下の低周波ノイズ除去
- **ローパスフィルター**: 8000Hz以上の高周波ノイズ除去
- **振幅平滑化**: スパイクノイズの除去

### 4. 音声処理最適化
- **チャンクサイズ縮小**: 3200バイト → 1600バイト（より細かい処理）
- **音声検出感度向上**: 閾値を100 → 50に調整
- **無音トリミング改善**: 閾値を500 → 300に調整

### 5. リアルタイム品質監視
- **音声レベル監視**: 2秒間隔で音声レベルをチェック
- **ユーザーガイダンス**: 低い音声レベルや無音状態の警告
- **自動停止**: 録音停止時に監視も自動停止

## 技術仕様

### Flutter側（unified_voice_service.dart）
```dart
RecordConfig(
  encoder: AudioEncoder.aacLc,
  bitRate: 192000,     // 192kbps
  sampleRate: 44100,   // 44.1kHz
  numChannels: 1,      // モノラル
)
```

### Android側（MainActivity.kt）
- **音声レベル分析**: 最大振幅、平均振幅、RMS計算
- **3段階増幅制御**: 3000/8000/28000の閾値
- **ノイズリダクション**: 3段階フィルタリング
- **チャンク処理**: 0.05秒単位での細かい処理

## パフォーマンス向上

### 認識精度の改善
- **低音声レベル対応**: 自動増幅により小さな声でも認識
- **ノイズ耐性**: 背景ノイズがある環境での認識向上
- **応答性向上**: 細かいチャンク処理により即応性向上

### ユーザビリティ向上
- **リアルタイムフィードバック**: 録音品質の状況をリアルタイム表示
- **ガイダンス表示**: 適切な録音方法をアドバイス
- **視覚的確認**: 設定画面で品質設定を確認可能

## 使用方法

### 自動適用
- すべての改善は自動的に適用されます
- ユーザーによる追加設定は不要

### 品質確認
1. 設定画面を開く
2. 「録音品質設定」セクションを確認
3. 各機能の有効状態を確認

### 録音時のガイダンス
- 音声レベルが低い場合: 「マイクに近づいてください」
- 長時間無音の場合: 「話しかけてください」

## 今後の拡張可能性

### 追加可能な機能
1. **ユーザー設定**: 品質設定のカスタマイズ
2. **環境適応**: 周囲の騒音レベルに応じた自動調整
3. **音質分析**: 録音後の音質評価とフィードバック
4. **複数マイク対応**: 外部マイク使用時の最適化

### パフォーマンス最適化
1. **並列処理**: ノイズリダクションの並列化
2. **メモリ最適化**: 大容量音声ファイルの効率的処理
3. **バッテリー最適化**: 処理負荷の軽減

## 互換性

### プラットフォーム対応
- **Android**: 完全対応（ネイティブ処理）
- **iOS**: 部分対応（今後の実装予定）
- **Web**: 制限あり（Web Speech API使用）

### デバイス要件
- **最小メモリ**: 2GB RAM
- **推奨メモリ**: 4GB RAM以上
- **ストレージ**: 追加要件なし
